<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Go WebSocket Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h2>Go WebSocket Chat</h2>
  <p>WebSocket ile gerÃ§ek zamanlÄ± sohbet uygulamasÄ±</p>
  <input id="username" placeholder="KullanÄ±cÄ± adÄ±nÄ±z" /><br><br>
  <p>Mesaj gÃ¶ndermek iÃ§in kullanÄ±cÄ± adÄ±nÄ±zÄ± girin ve mesajÄ±nÄ±zÄ± yazÄ±n. MesajlarÄ±nÄ±zda emojiler kullanabilirsiniz (Ã¶rn: :smile:).</p>
  <input id="message" placeholder="MesajÄ±nÄ±z (Ã¶rn: :smile:)" />

  <button onclick="sendMessage()">GÃ¶nder</button>

  <div class="chat-area">
    <ul id="chat"></ul>
  </div>

  <script>
    let socket; // WebSocket baÄŸlantÄ±sÄ± iÃ§in global deÄŸiÅŸken
    // Mesaj gÃ¶ndermek iÃ§in fonksiyon

    function sendMessage() {
      // KullanÄ±cÄ± adÄ±nÄ± ve mesajÄ± alÄ±r
      const username = document.getElementById("username").value.trim();
      const msg = document.getElementById("message").value.trim();
      // EÄŸer kullanÄ±cÄ± adÄ± boÅŸsa uyarÄ± verir
      if (!username) {
        alert("LÃ¼tfen kullanÄ±cÄ± adÄ±nÄ±zÄ± girin.");
        return;
      }
      // EÄŸer mesaj boÅŸsa uyarÄ± verir
      if (!msg) {
        alert("LÃ¼tfen mesajÄ±nÄ±zÄ± girin.");
        return;
      }
      // EÄŸer WebSocket baÄŸlantÄ±sÄ± yoksa veya baÄŸlantÄ± aÃ§Ä±k deÄŸilse yeni bir WebSocket
      // oluÅŸturur ve kullanÄ±cÄ± adÄ±nÄ± gÃ¶nderir
      // EÄŸer baÄŸlantÄ± aÃ§Ä±ksa, mesajÄ± gÃ¶nderir ve mesaj kutusunu temizler
      // Gelen mesajlarÄ± dinler ve uygun ÅŸekilde listeye ekler
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        socket = new WebSocket("ws://localhost:8080/ws");
        // WebSocket baÄŸlantÄ±sÄ± aÃ§Ä±ldÄ±ÄŸÄ±nda kullanÄ±cÄ± adÄ±nÄ± gÃ¶nderir
        // EÄŸer mesaj varsa, mesajÄ± gÃ¶nderir ve mesaj kutusunu temizler
        socket.onopen = function () {
          socket.send(username);
          if (msg) {
            socket.send(msg);
            document.getElementById("message").value = "";
          }
        };
        // WebSocket Ã¼zerinden gelen mesajlarÄ± dinler
        // Mesajlar, listeye eklenir ve uygun ÅŸekilde renklendirilir
        socket.onmessage = function (event) {
          const li = document.createElement("li");
          const msg = event.data;

          if (msg.includes("katÄ±ldÄ±")) {
            li.style.color = "blue";
            li.style.fontWeight = "bold";
          } else if (msg.includes("ayrÄ±ldÄ±")) {
            li.style.color = "red";
            li.style.fontWeight = "bold";
          } else if (msg.startsWith("ğŸ‘¥")) {
            li.style.color = "green";
            li.style.fontStyle = "italic";
          }

          li.textContent = msg;
          document.getElementById("chat").appendChild(li);
        };
        // WebSocket baÄŸlantÄ±sÄ± hatasÄ± olduÄŸunda uyarÄ± verir
        socket.onerror = function (error) {
          alert("BaÄŸlantÄ± hatasÄ±: " + error.message);
        };
        // BaÄŸlantÄ± kapatÄ±ldÄ±ÄŸÄ±nda konsola mesaj yazar
        socket.onclose = function () {
          console.log("BaÄŸlantÄ± kapatÄ±ldÄ±.");
        };
      } else {  
        // EÄŸer WebSocket baÄŸlantÄ±sÄ± aÃ§Ä±ksa, mesajÄ± gÃ¶nderir ve mesaj kutusunu temizler
        // Mesaj kutusu boÅŸ deÄŸilse, mesajÄ± gÃ¶nderir ve mesaj kutusunu temizler
        // Bu, kullanÄ±cÄ± adÄ±nÄ± gÃ¶ndermeden Ã¶nce yapÄ±lÄ±r
        // BÃ¶ylece kullanÄ±cÄ± adÄ±nÄ± her mesaj gÃ¶nderdiÄŸinde tekrar gÃ¶ndermemiÅŸ olur
        // Bu, kullanÄ±cÄ± adÄ±nÄ±n sadece ilk mesajda gÃ¶nderilmesini saÄŸlar
        if (msg) {
          socket.send(msg);
          document.getElementById("message").value = "";
        }
      }
    }
      
    document.getElementById("message").addEventListener("keydown", function (e) {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>